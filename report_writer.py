#!/usr/bin/env python
# coding: utf-8

# In[ ]:


import streamlit as st
from openai import OpenAI

# ğŸ”‘ OpenAI API í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])

def report_writer_app():
    st.title("ğŸ§  AI ê¸°ë°˜ ì—…ë¬´ë³´ê³  ìƒì„±ê¸°")

    # 1. ë³´ê³ ì„œ ìœ í˜• ì„ íƒ
    report_type = st.selectbox("ğŸ“Œ ë³´ê³ ì„œ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”", ["ì—…ë¬´ë³´ê³ ", "ë™í–¥ë³´ê³ ", "í–‰ì‚¬ë³´ê³ "])

    # 2. ê³µí†µ ì…ë ¥
    department = st.text_input("ğŸ¢ ë¶€ì„œëª…")
    writer = st.text_input("âœï¸ ì‘ì„±ì ì´ë¦„")
    key_points = st.text_area("ğŸ§© ì£¼ìš” ë‚´ìš© í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)", placeholder="ì˜ˆ: ë¯¼ì›ì²˜ë¦¬, ì£¼ì°¨ì¥ ì¡°ì„±, ì£¼ë¯¼ì„¤ëª…íšŒ")

    # 3. ìƒì„± ë²„íŠ¼
    if st.button("ğŸ“„ ë³´ê³ ì„œ ìë™ ìƒì„±"):
        if not department or not writer or not key_points:
            st.warning("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
            return

        system_prompt = "ë„ˆëŠ” ì§€ë°©ìì¹˜ë‹¨ì²´ ê³µë¬´ì›ì´ ì‘ì„±í•˜ëŠ” í–‰ì •ë³´ê³ ì„œë¥¼ ëŒ€ì‹  ì‘ì„±í•´ì£¼ëŠ” AIì•¼. ëª¨ë“  ë³´ê³ ì„œëŠ” 'ê°œê´„ì‹' í•­ëª© êµ¬ë¶„ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ê³ , ë¬¸ì²´ëŠ” í–‰ì •ë¬¸ì„œì²´ë¥¼ ë”°ë¥¼ ê²ƒ."

        user_prompts = {
            "ì—…ë¬´ë³´ê³ ": f"""
ë‹¤ìŒ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ 'ì—…ë¬´ë³´ê³ ' í˜•ì‹ì˜ ë³´ê³ ì„œë¥¼ ì•„ë˜ í•­ëª© êµ¬ì¡°ë¡œ ì‘ì„±í•´ì¤˜:

- ë³´ê³ ìœ í˜•: ì—…ë¬´ë³´ê³ 
- ë¶€ì„œëª…: {department}
- ì‘ì„±ì: {writer}
- ì£¼ìš” í‚¤ì›Œë“œ: {key_points}

ë³´ê³ ì„œ í•­ëª© êµ¬ì„±:
- ì—…ë¬´ëª…:
- ì¶”ì§„ì¼ì •:
- ì¶”ì§„ë‚´ìš©:
- ê´€ë ¨ë¶€ì„œ:
- í–¥í›„ê³„íš:
""",
            "ë™í–¥ë³´ê³ ": f"""
ë‹¤ìŒ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ 'ë™í–¥ë³´ê³ ' í˜•ì‹ì˜ ë³´ê³ ì„œë¥¼ ì•„ë˜ í•­ëª© êµ¬ì¡°ë¡œ ì‘ì„±í•´ì¤˜:

- ë³´ê³ ìœ í˜•: ë™í–¥ë³´ê³ 
- ë¶€ì„œëª…: {department}
- ì‘ì„±ì: {writer}
- ì£¼ìš” í‚¤ì›Œë“œ: {key_points}

ë³´ê³ ì„œ í•­ëª© êµ¬ì„±:
- ì‚¬ê±´ì¼ì‹œ:
- ì‚¬ê±´ì¥ì†Œ:
- ì‚¬ê±´ë‚´ì—­:
- ëŒ€ì‘ì¡°ì¹˜:
- í–¥í›„ê³„íš:
""",
            "í–‰ì‚¬ë³´ê³ ": f"""
ë‹¤ìŒ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ 'í–‰ì‚¬ë³´ê³ ' í˜•ì‹ì˜ ë³´ê³ ì„œë¥¼ ì•„ë˜ í•­ëª© êµ¬ì¡°ë¡œ ì‘ì„±í•´ì¤˜:

- ë³´ê³ ìœ í˜•: í–‰ì‚¬ë³´ê³ 
- ë¶€ì„œëª…: {department}
- ì‘ì„±ì: {writer}
- ì£¼ìš” í‚¤ì›Œë“œ: {key_points}

ë³´ê³ ì„œ í•­ëª© êµ¬ì„±:
- í–‰ì‚¬ëª…:
- í–‰ì‚¬ì¼ì‹œ:
- í–‰ì‚¬ì¥ì†Œ:
- ì£¼ìš”ë‚´ìš©:
- ì°¸ì„ì:
- í–¥í›„ê³„íš:
"""
        }

        with st.spinner("ğŸ“¡ GPTê°€ ë³´ê³ ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤..."):
            response = client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_prompts[report_type]}
                ],
                temperature=0.4
            )

            content = response.choices[0].message.content.strip()

        st.success("âœ… ë³´ê³ ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!")
        st.markdown("### ğŸ“ ìƒì„±ëœ ë³´ê³ ì„œ")
        st.markdown(f"**ë³´ê³ ì„œ ìœ í˜•:** {report_type}")
        st.markdown(f"**ë¶€ì„œëª…:** {department}  |  **ì‘ì„±ì:** {writer}")
        st.markdown("---")
        st.markdown(content.replace("\n", "\n\n"))

